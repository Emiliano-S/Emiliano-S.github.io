import{a as l,b as f,c as k,d as A}from"./chunk-QUWXQOXU.js";import{r as j}from"./chunk-Z237CGI5.js";import{Cb as y,L as g,O as n,a as h,k as m,u as p}from"./chunk-HL3SKBVK.js";import{a as d,h as u}from"./chunk-HFBR4SKI.js";var $=(()=>{let a=class a{constructor(e,t,s){this.db=e,this.afAuth=t,this.http=s,this.dbPath="/certificates",this.questionRef=e.list(this.dbPath),this.dataBase=k()}getCertificates(e){return this.db.object(`${this.dbPath}/${e}`)}updateSubscriptionStatus(e,t){return new Promise((s,r)=>{this.db.list("/users",i=>i.orderByChild("email").equalTo(e)).snapshotChanges().subscribe(i=>{if(i.length>0){let o=i[0].key;this.db.object(`/users/${o}`).update({subscriptionActive:t}).then(()=>{s()}).catch(b=>{console.error("Error updating subscription status:",b),r(b)})}else r(new Error("User not found in database"))})})}checkSubscriptionStatus(e){return u(this,null,function*(){try{return!!(yield this.db.object(`/users/${e}/subscriptionActive`).valueChanges().pipe(p(1)).toPromise())}catch(t){return console.error("Error checking subscription status:",t),!1}})}getUserDB(e){return u(this,null,function*(){try{return yield this.db.object(`/users/${e}`).valueChanges().pipe(p(1)).toPromise()}catch(t){return console.error("Error checking subscription status:",t),!1}})}getTotalUsersWithPayTrue(){let e=l(this.dataBase,"/users");return new h(t=>{f(e,s=>{let r=s.val();if(r){let i=Object.values(r).filter(o=>o.pay===!0).length;t.next(i)}else t.next(0);t.complete()},s=>{t.error(s)})})}getTotalUsersWithSubscriptionActiveTrue(){let e=l(this.dataBase,"/users");return new h(t=>{f(e,s=>{let r=s.val();if(r){let i=Object.values(r).filter(o=>o.subscriptionActive===!0).length;t.next(i)}else t.next(0);t.complete()},s=>{t.error(s)})})}getUsers(){return this.db.list("/users").snapshotChanges().pipe(m(e=>e.map(t=>d({key:t.payload.key},t.payload.val()))))}deleteUser(e){return this.http.post("https://us-central1-testiq-abc9f.cloudfunctions.net/corsDeleteUser",{uid:e})}};a.\u0275fac=function(t){return new(t||a)(n(A),n(j),n(y))},a.\u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"});let c=a;return c})();export{$ as a};
